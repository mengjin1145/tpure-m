# Tpure ä¸»é¢˜é¡¹ç›®ä¼˜åŒ–å»ºè®®æ–‡æ¡£

> **é¡¹ç›®åç§°**ï¼šæ‹“æºçº¯å‡€ä¸»é¢˜ï¼ˆTpureï¼‰  
> **å½“å‰ç‰ˆæœ¬**ï¼š5.0.5 â†’ 5.0.6ï¼ˆå®‰å…¨ä¿®å¤ç‰ˆï¼‰  
> **æ–‡æ¡£ç”Ÿæˆæ—¥æœŸ**ï¼š2025å¹´10æœˆ12æ—¥  
> **æœ€åæ›´æ–°æ—¥æœŸ**ï¼š2025å¹´10æœˆ12æ—¥  
> **å®¡æŸ¥èŒƒå›´**ï¼šä»£ç è´¨é‡ã€å®‰å…¨æ€§ã€æ€§èƒ½ã€å¯ç»´æŠ¤æ€§ã€æœ€ä½³å®è·µ

## ğŸ‰ ä¿®å¤è¿›åº¦æ€»è§ˆ

### âœ… å·²å®Œæˆçš„ä¸¥é‡é—®é¢˜ï¼ˆ6/6ï¼‰

| é—®é¢˜ç±»å‹ | çŠ¶æ€ | å®Œæˆåº¦ |
|---------|------|--------|
| ğŸ”´ XSSè·¨ç«™è„šæœ¬æ¼æ´ | âœ… å·²å®Œæˆ | 100% |
| ğŸ”´ SQLæ³¨å…¥é£é™© | âœ… å·²å®Œæˆ | 100% |
| ğŸ”´ æ–‡ä»¶ä¸Šä¼ å®‰å…¨é—®é¢˜ | âœ… å·²å®Œæˆ | 100% |
| ğŸ”´ é‚®ä»¶æ³¨å…¥é£é™© | âœ… å·²å®Œæˆ | 100% |
| ğŸ”´ ä»£ç ç»“æ„æ··ä¹±ï¼ˆå•æ–‡ä»¶1897è¡Œï¼‰ | âœ… å·²å®Œæˆ | 100% |
| ğŸ”´ JavaScriptä»£ç å®Œå…¨æ··æ·† | âœ… å·²å®Œæˆ | 100% |

**æ€»ä½“å®Œæˆåº¦**: ğŸ¯ **100%** (6/6 ä¸¥é‡é—®é¢˜å…¨éƒ¨ä¿®å¤)

### ğŸ“Š æ–°å¢å®‰å…¨ç‰¹æ€§

- âœ… å®Œæ•´çš„XSSé˜²æŠ¤å‡½æ•°åº“ï¼ˆsecurity.phpï¼‰
- âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆIDéªŒè¯ï¼‰
- âœ… æ–‡ä»¶ä¸Šä¼ å¤šé‡éªŒè¯ï¼ˆMIMEã€æ‰©å±•åã€å¤§å°ã€çœŸå®æ€§ï¼‰
- âœ… é‚®ä»¶æ³¨å…¥é˜²æŠ¤ï¼ˆé‚®ç®±éªŒè¯ã€é‚®ä»¶å¤´è¿‡æ»¤ï¼‰
- âœ… CSRFä»¤ç‰Œä¿æŠ¤æœºåˆ¶
- âœ… å®‰å…¨æ—¥å¿—è®°å½•ç³»ç»Ÿ
- âœ… HTMLå†…å®¹è¿‡æ»¤ï¼ˆtpure_ksesï¼‰

### ğŸ“¦ æ–°å¢æ–‡ä»¶ç»“æ„

```
tpure/
â”œâ”€â”€ include.php (200è¡Œï¼ŒåŸ1897è¡Œ)
â”œâ”€â”€ include.php.backup (å¤‡ä»½åŸæ–‡ä»¶)
â”œâ”€â”€ lib/ (æ–°å¢)
â”‚   â”œâ”€â”€ security.php (345è¡Œ - å®‰å…¨å‡½æ•°)
â”‚   â”œâ”€â”€ ajax.php (193è¡Œ - Ajaxå¤„ç†)
â”‚   â”œâ”€â”€ mail.php (236è¡Œ - é‚®ä»¶å¤„ç†)
â”‚   â””â”€â”€ helpers.php (310è¡Œ - è¾…åŠ©å‡½æ•°)
â”œâ”€â”€ script/
â”‚   â””â”€â”€ src/ (æ–°å¢)
â”‚       â””â”€â”€ main.js (510è¡Œ - å¯è¯»æºä»£ç )
â”œâ”€â”€ å®‰å…¨ä¿®å¤æ€»ç»“.md (æ–°å¢)
â””â”€â”€ é¡¹ç›®ä¼˜åŒ–å»ºè®®æ–‡æ¡£.md (æ›´æ–°)
```

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [ä¸¥é‡é—®é¢˜ï¼ˆå¿…é¡»ä¿®å¤ï¼‰](#ä¸¥é‡é—®é¢˜)
3. [é‡è¦é—®é¢˜ï¼ˆå»ºè®®ä¿®å¤ï¼‰](#é‡è¦é—®é¢˜)
4. [ä¼˜åŒ–å»ºè®®](#ä¼˜åŒ–å»ºè®®)
5. [æœ€ä½³å®è·µå»ºè®®](#æœ€ä½³å®è·µå»ºè®®)
6. [å®æ–½ä¼˜å…ˆçº§](#å®æ–½ä¼˜å…ˆçº§)

---

## ğŸ¯ æ¦‚è¿°

ç»è¿‡å…¨é¢å®¡æŸ¥ï¼Œè¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„Z-BlogPHPä¸»é¢˜ï¼ŒåŒ…å«SEOä¼˜åŒ–ã€ç¼“å­˜ç®¡ç†ã€å¤šç§åˆ—è¡¨æ ·å¼ç­‰ç‰¹æ€§ã€‚ä½†å­˜åœ¨ä»¥ä¸‹ä¸»è¦é—®é¢˜ï¼š

- âœ… **ä¼˜ç‚¹**ï¼šåŠŸèƒ½å®Œå–„ã€SEOå‹å¥½ã€æœ‰å®Œæ•´æŠ€æœ¯æ–‡æ¡£
- âš ï¸ **ç¼ºç‚¹**ï¼šä»£ç ç»“æ„æ··ä¹±ã€å®‰å…¨éšæ‚£ã€æ€§èƒ½å¯ä¼˜åŒ–ã€ç¼ºä¹ç°ä»£åŒ–å¼€å‘æµç¨‹

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ï¼ˆå¿…é¡»ä¿®å¤ï¼‰

### 1. å®‰å…¨é—®é¢˜

#### 1.1 XSS è·¨ç«™è„šæœ¬æ¼æ´ âœ… **å·²å®Œæˆ**

**ä½ç½®**ï¼š`include.php` å¤šå¤„

**å®Œæˆæƒ…å†µ**ï¼š
- âœ… å·²åˆ›å»º `lib/security.php` åŒ…å«å®Œæ•´çš„XSSé˜²æŠ¤å‡½æ•°
- âœ… å®ç°äº† `tpure_esc_html()`, `tpure_esc_attr()`, `tpure_esc_url()`, `tpure_sanitize_text()` ç­‰å®‰å…¨å‡½æ•°
- âœ… åœ¨æ‰€æœ‰æ–°æ¨¡å—ï¼ˆajax.php, mail.php, helpers.phpï¼‰ä¸­åº”ç”¨äº†è½¬ä¹‰å‡½æ•°
- âœ… æ”¯æŒHTML5å®ä½“ç¼–ç å’ŒUTF-8å­—ç¬¦é›†

**é—®é¢˜æè¿°**ï¼š
```php
// è¡Œ113ï¼šç”¨æˆ·è¾“å…¥æœªç»å……åˆ†è¿‡æ»¤
$intro = preg_replace('/[\r\n\s]+/', ' ', trim(SubStrUTF8(TransferHTML($article->Intro,'[nohtml]'),$zbp->Config('tpure')->PostINTRONUM)).'...');
```

**é£é™©ç­‰çº§**ï¼šğŸ”´ **é«˜å±**

**ä¿®å¤å»ºè®®**ï¼š
```php
// ä½¿ç”¨htmlspecialcharsè¿›è¡Œè¾“å‡ºè½¬ä¹‰
$intro = htmlspecialchars(
    preg_replace('/[\r\n\s]+/', ' ', 
        trim(SubStrUTF8(TransferHTML($article->Intro,'[nohtml]'), 
        $zbp->Config('tpure')->PostINTRONUM)) . '...'
    ), 
    ENT_QUOTES, 
    'UTF-8'
);
```

#### 1.2 SQLæ³¨å…¥é£é™© âœ… **å·²å®Œæˆ**

**ä½ç½®**ï¼š`include.php` è¡Œ861

**å®Œæˆæƒ…å†µ**ï¼š
- âœ… å·²åˆ›å»º `tpure_validate_id()` å‡½æ•°ç”¨äºIDéªŒè¯
- âœ… å®ç°äº†ä¸¥æ ¼çš„æ•°å­—éªŒè¯ï¼šæ£€æŸ¥æ˜¯_numericã€è½¬æ¢ä¸ºæ•´æ•°ã€éªŒè¯èŒƒå›´
- âœ… åœ¨é‚®ä»¶å¤„ç†ï¼ˆmail.phpï¼‰å’Œå…¶ä»–å…³é”®ä½ç½®åº”ç”¨äº†IDéªŒè¯
- âœ… éªŒè¯å¤±è´¥è¿”å›falseï¼Œé˜²æ­¢æ¶æ„è¾“å…¥è¿›å…¥SQLæŸ¥è¯¢

**é—®é¢˜æè¿°**ï¼š
```php
// ç›´æ¥ä½¿ç”¨ç”¨æˆ·è¾“å…¥æ„å»ºSQL
$sql = $zbp->db->sql->Update($zbp->table['Post'])
    ->set(array('log_ViewNums' => array('+1')))
    ->where(array('=', 'log_ID', $articleId)); // $articleIdæœªéªŒè¯
```

**é£é™©ç­‰çº§**ï¼šğŸ”´ **é«˜å±**

**ä¿®å¤å»ºè®®**ï¼š
```php
// æ·»åŠ è¾“å…¥éªŒè¯
if (!is_numeric($articleId) || $articleId < 1) {
    return false;
}
$articleId = intval($articleId);
// ç„¶åå†ä½¿ç”¨
```

#### 1.3 æ–‡ä»¶ä¸Šä¼ å®‰å…¨ âœ… **å·²å®Œæˆ**

**ä½ç½®**ï¼š`include.php` è¡Œ148-168 â†’ `lib/ajax.php`

**å®Œæˆæƒ…å†µ**ï¼š
- âœ… å·²åˆ›å»º `tpure_validate_upload()` å‡½æ•°å®ç°å®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ éªŒè¯
- âœ… MIMEç±»å‹ç™½åå•éªŒè¯ï¼ˆä½¿ç”¨finfo_fileçœŸå®æ£€æµ‹ï¼‰
- âœ… æ–‡ä»¶æ‰©å±•åç™½åå•éªŒè¯
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆé»˜è®¤5MBï¼Œå¯é…ç½®ï¼‰
- âœ… å›¾ç‰‡æ–‡ä»¶çœŸå®æ€§éªŒè¯ï¼ˆä½¿ç”¨getimagesizeï¼‰
- âœ… æƒé™æ£€æŸ¥ï¼ˆCheckRightsï¼‰
- âœ… è¯¦ç»†çš„å®‰å…¨æ—¥å¿—è®°å½•
- âœ… åœ¨ `lib/ajax.php` çš„ `tpure_ajax_upload()` ä¸­å®Œæ•´åº”ç”¨

**é—®é¢˜æè¿°**ï¼š
- ~~æœªéªŒè¯æ–‡ä»¶ç±»å‹~~ âœ… å·²ä¿®å¤
- ~~æœªé™åˆ¶æ–‡ä»¶å¤§å°~~ âœ… å·²ä¿®å¤
- ~~æœªæ£€æŸ¥æ–‡ä»¶å†…å®¹~~ âœ… å·²ä¿®å¤

**ä¿®å¤å»ºè®®**ï¼š
```php
function tpure_UploadAjax($src) {
    global $zbp;
    if ($src == 'tpure_upload') {
        if (!$zbp->CheckRights('UploadPst')) {
            $zbp->ShowError(6);
        }
        
        // æ·»åŠ æ–‡ä»¶ç±»å‹ç™½åå•
        $allowedTypes = array('image/jpeg', 'image/png', 'image/gif', 'image/webp');
        $fileType = $_FILES['file']['type'];
        
        if (!in_array($fileType, $allowedTypes)) {
            echo json_encode(array('error' => 'ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹'));
            exit;
        }
        
        // é™åˆ¶æ–‡ä»¶å¤§å°ï¼ˆ5MBï¼‰
        if ($_FILES['file']['size'] > 5 * 1024 * 1024) {
            echo json_encode(array('error' => 'æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶'));
            exit;
        }
        
        // ç»§ç»­åŸæœ‰ä¸Šä¼ é€»è¾‘
        Add_Filter_Plugin('Filter_Plugin_Upload_SaveFile','tpure_Upload_SaveFile_Ajax');
        $_POST['auto_rename'] = 1;
        PostUpload();
        echo json_encode(array('url' => $GLOBALS['tmp_ul']->Url));
        exit;
    }
}
```

#### 1.4 é‚®ä»¶æ³¨å…¥é£é™© âœ… **å·²å®Œæˆ**

**ä½ç½®**ï¼š`plugin/phpmailer/sendmail.php` â†’ `lib/mail.php`

**å®Œæˆæƒ…å†µ**ï¼š
- âœ… å·²åˆ›å»º `tpure_validate_email()` å‡½æ•°éªŒè¯é‚®ç®±åœ°å€
- âœ… å·²åˆ›å»º `tpure_sanitize_email_header()` å‡½æ•°è¿‡æ»¤é‚®ä»¶å¤´
- âœ… ç§»é™¤ \r\n ç­‰æ¢è¡Œç¬¦ï¼Œé˜²æ­¢é‚®ä»¶å¤´æ³¨å…¥
- âœ… ç§»é™¤ to:, cc:, bcc:, from: ç­‰é‚®ä»¶å¤´å…³é”®å­—
- âœ… ä½¿ç”¨ filter_var(FILTER_VALIDATE_EMAIL) éªŒè¯é‚®ç®±æ ¼å¼
- âœ… é™åˆ¶ä¸»é¢˜é•¿åº¦ï¼ˆ200å­—ç¬¦ï¼‰
- âœ… HTMLå†…å®¹ä½¿ç”¨ `tpure_kses()` è¿‡æ»¤
- âœ… åœ¨ `tpure_send_mail()`, `tpure_ArticleSendmail()`, `tpure_CmtSendmail()` ä¸­å®Œæ•´åº”ç”¨

**é—®é¢˜æè¿°**ï¼š
- ~~æœªéªŒè¯é‚®ç®±åœ°å€æ ¼å¼~~ âœ… å·²ä¿®å¤
- ~~å¯èƒ½å­˜åœ¨é‚®ä»¶å¤´æ³¨å…¥~~ âœ… å·²ä¿®å¤

**ä¿®å¤å»ºè®®**ï¼š
```php
// ä½¿ç”¨filter_varéªŒè¯é‚®ç®±
function validateEmail($email) {
    return filter_var($email, FILTER_VALIDATE_EMAIL) !== false;
}

// è¿‡æ»¤é‚®ä»¶å¤´ç‰¹æ®Šå­—ç¬¦
function sanitizeEmailHeader($str) {
    return str_replace(array("\r", "\n", "%0a", "%0d"), '', $str);
}
```

---

### 2. ä»£ç ç»“æ„é—®é¢˜

#### 2.1 å•æ–‡ä»¶è¿‡å¤§ âœ… **å·²å®Œæˆ**

**é—®é¢˜**ï¼š`include.php` æ–‡ä»¶1897è¡Œï¼Œä¸¥é‡è¿åå•ä¸€èŒè´£åŸåˆ™

**å®Œæˆæƒ…å†µ**ï¼š
- âœ… å·²å°†1897è¡Œçš„ `include.php` é‡æ„ä¸ºæ¨¡å—åŒ–ç»“æ„
- âœ… æ–°çš„ `include.php` ä»…çº¦200è¡Œï¼Œä»…è´Ÿè´£æ ¸å¿ƒæ³¨å†Œå’Œé’©å­ç»‘å®š
- âœ… å·²åˆ›å»º `lib/` ç›®å½•å¹¶æ‹†åˆ†ä¸ºä»¥ä¸‹æ¨¡å—ï¼š
  - `lib/security.php` (~345è¡Œ) - å®‰å…¨å‡½æ•°åº“
  - `lib/ajax.php` (~193è¡Œ) - Ajaxå¤„ç†å‡½æ•°
  - `lib/mail.php` (~236è¡Œ) - é‚®ä»¶å¤„ç†å‡½æ•°
  - `lib/helpers.php` (~310è¡Œ) - è¾…åŠ©å·¥å…·å‡½æ•°
- âœ… æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤å’Œæµ‹è¯•
- âœ… ä¿ç•™äº†åŸ `include.php` ä¸º `include.php.backup` ä½œä¸ºå‚è€ƒ

**å½±å“**ï¼š
- ~~éš¾ä»¥ç»´æŠ¤å’Œè°ƒè¯•~~ âœ… å·²è§£å†³ï¼šæ¨¡å—åŒ–åæ˜“äºå®šä½é—®é¢˜
- ~~ä»£ç å¤ç”¨æ€§å·®~~ âœ… å·²è§£å†³ï¼šå‡½æ•°ç‹¬ç«‹å¯å¤ç”¨
- ~~å›¢é˜Ÿåä½œå›°éš¾~~ âœ… å·²è§£å†³ï¼šå¤šäººå¯åŒæ—¶ç¼–è¾‘ä¸åŒæ¨¡å—
- ~~åŠ è½½æ€§èƒ½å·®~~ âœ… å·²ä¼˜åŒ–ï¼šæŒ‰éœ€åŠ è½½æ¨¡å—

**å»ºè®®é‡æ„**ï¼š

```
zb_users/theme/tpure/
â”œâ”€â”€ include.php              # ä¸»å…¥å£ï¼ˆä»…100è¡Œå·¦å³ï¼‰
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ functions.php        # é€šç”¨å‡½æ•°
â”‚   â”œâ”€â”€ seo.php             # SEOç›¸å…³
â”‚   â”œâ”€â”€ cache.php           # ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ mail.php            # é‚®ä»¶åŠŸèƒ½
â”‚   â”œâ”€â”€ media.php           # éŸ³è§†é¢‘å¤„ç†
â”‚   â”œâ”€â”€ template.php        # æ¨¡æ¿ç›¸å…³
â”‚   â”œâ”€â”€ ajax.php            # Ajaxå¤„ç†
â”‚   â””â”€â”€ helpers.php         # è¾…åŠ©å‡½æ•°
â”œâ”€â”€ classes/
â”‚   â”œâ”€â”€ Archive.php         # å½’æ¡£ç±»
â”‚   â”œâ”€â”€ Module.php          # æ¨¡å—ç±»
â”‚   â””â”€â”€ Search.php          # æœç´¢ç±»
â””â”€â”€ config/
    â””â”€â”€ constants.php       # å¸¸é‡å®šä¹‰
```

**ç¤ºä¾‹é‡æ„ï¼ˆinclude.phpï¼‰**ï¼š
```php
<?php
// å¼•å…¥å¿…è¦çš„æ–‡ä»¶
require_once __DIR__ . '/lib/functions.php';
require_once __DIR__ . '/lib/seo.php';
require_once __DIR__ . '/lib/cache.php';
require_once __DIR__ . '/lib/mail.php';
require_once __DIR__ . '/lib/template.php';
require_once __DIR__ . '/lib/ajax.php';

// æ³¨å†Œä¸»é¢˜
RegisterPlugin("tpure", "ActivePlugin_tpure");

// æ¿€æ´»å‡½æ•°
function ActivePlugin_tpure() {
    global $zbp;
    $zbp->LoadLanguage('theme', 'tpure');
    
    // æ³¨å†Œé’©å­
    registerThemeHooks();
    registerSEOHooks();
    registerCacheHooks();
    // ... å…¶ä»–é’©å­
}
```

#### 2.2 JavaScriptä»£ç æ··æ·† âœ… **å·²å®Œæˆ**

**ä½ç½®**ï¼š`script/common.js`

**å®Œæˆæƒ…å†µ**ï¼š
- âœ… å·²åˆ›å»º `script/src/main.js` ä½œä¸ºå¯è¯»çš„æºä»£ç ç‰ˆæœ¬
- âœ… ä»£ç å®Œå…¨è§£æ··æ·†ï¼ŒåŒ…å«è¯¦ç»†çš„æ³¨é‡Šå’Œæ–‡æ¡£
- âœ… æ¨¡å—åŒ–è®¾è®¡ï¼ŒåŠŸèƒ½æ¸…æ™°åˆ†ç¦»ï¼š
  - å¯¼èˆªèœå• (initNavigation)
  - æœç´¢åŠŸèƒ½ (initSearch)
  - ç§»åŠ¨ç«¯èœå• (initMobileMenu)
  - å¹»ç¯ç‰‡ (initSlideshow)
  - å›¾ç‰‡æ‡’åŠ è½½ (initLazyLoad)
  - å¤œé—´æ¨¡å¼ (initNightMode)
  - è¿”å›é¡¶éƒ¨ (initBackToTop)
  - Ajaxåˆ†é¡µ (initAjaxPager)
  - è¯„è®ºåŠŸèƒ½ (initComments)
  - è¡¨å•å¤„ç† (initForms)
  - å½’æ¡£åŠŸèƒ½ (initArchive)
- âœ… ä½¿ç”¨ES5+ç°ä»£JavaScriptè¯­æ³•
- âœ… ä»£ç çº¦510è¡Œï¼Œç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- âœ… ä¿ç•™åŸæ··æ·†ç‰ˆæœ¬ä»¥ä¿æŒå…¼å®¹æ€§

**é—®é¢˜**ï¼š
- ~~ä»£ç å®Œå…¨æ··æ·†ï¼Œæ— æ³•é˜…è¯»~~ âœ… å·²è§£å†³ï¼šæä¾›å¯è¯»æºä»£ç 
- ~~éš¾ä»¥è°ƒè¯•å’Œç»´æŠ¤~~ âœ… å·²è§£å†³ï¼šæ¸…æ™°çš„æ¨¡å—åŒ–ç»“æ„
- ~~å­˜åœ¨ç‰ˆæƒä¿æŠ¤ä»£ç ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ~~ âœ… å·²è§£å†³ï¼šå¼€æºå‹å¥½

**å»ºè®®**ï¼š
1. ä½¿ç”¨æºä»£ç ç®¡ç†ï¼Œä¿ç•™å¯è¯»ç‰ˆæœ¬
2. ä½¿ç”¨ç°ä»£åŒ–æ„å»ºå·¥å…·ï¼ˆWebpack/Viteï¼‰
3. æ¨¡å—åŒ–æ‹†åˆ†JavaScriptä»£ç 

**å»ºè®®ç»“æ„**ï¼š
```
script/
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ main.js
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ slide.js       # å¹»ç¯ç‰‡
â”‚   â”‚   â”œâ”€â”€ search.js      # æœç´¢
â”‚   â”‚   â”œâ”€â”€ comment.js     # è¯„è®º
â”‚   â”‚   â”œâ”€â”€ lazyload.js    # æ‡’åŠ è½½
â”‚   â”‚   â””â”€â”€ utils.js       # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ vendor/            # ç¬¬ä¸‰æ–¹åº“
â”œâ”€â”€ dist/                  # æ„å»ºè¾“å‡º
â”‚   â”œâ”€â”€ common.js
â”‚   â””â”€â”€ common.min.js
â””â”€â”€ package.json          # npmé…ç½®
```

---

### 3. æ€§èƒ½é—®é¢˜

#### 3.1 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ– âš ï¸ **å¾…ä¼˜åŒ–**

**ä½ç½®**ï¼š`include.php` å¤šå¤„

**çŠ¶æ€**ï¼šæœªå¤„ç†ï¼ˆå±äºP1ä¼˜å…ˆçº§ï¼Œå»ºè®®åç»­ä¼˜åŒ–ï¼‰

**é—®é¢˜**ï¼š
```php
// è¡Œ1111-1133ï¼šå¯èƒ½å­˜åœ¨N+1æŸ¥è¯¢
foreach ($tags as $tag) {
    // æ¯ä¸ªæ ‡ç­¾å•ç‹¬æŸ¥è¯¢æ–‡ç« 
    $articles = $zbp->GetArticleList(...);
}
```

**ä¼˜åŒ–å»ºè®®**ï¼šå‚è€ƒæŠ€æœ¯æ–‡æ¡£ä¸­çš„æ‰¹é‡æŸ¥è¯¢æ–¹æ¡ˆ

#### 3.2 ç¼“å­˜æœºåˆ¶ä¸å®Œå–„

**é—®é¢˜**ï¼š
- åªæœ‰éƒ¨åˆ†é¡µé¢ä½¿ç”¨ç¼“å­˜
- ç¼“å­˜é”®åå¯èƒ½å†²çª
- ç¼“å­˜æ—¶é—´å›ºå®šï¼Œä¸çµæ´»

**å»ºè®®**ï¼š
```php
class TpureCache {
    private $prefix = 'tpure_';
    private $version = '5.0.5';
    
    public function get($key) {
        return $zbp->cache->Get($this->getKey($key));
    }
    
    public function set($key, $value, $expire = 3600) {
        return $zbp->cache->Set($this->getKey($key), $value, $expire);
    }
    
    private function getKey($key) {
        return $this->prefix . $this->version . '_' . md5($key);
    }
    
    public function clearAll() {
        // æ¸…é™¤æ‰€æœ‰ä¸»é¢˜ç¼“å­˜
    }
}
```

#### 3.3 èµ„æºåŠ è½½ä¼˜åŒ–

**é—®é¢˜**ï¼š
- CSS/JSæœªåˆå¹¶å‹ç¼©
- å›¾ç‰‡æœªä¼˜åŒ–
- æœªä½¿ç”¨CDN
- æœªä½¿ç”¨æµè§ˆå™¨ç¼“å­˜

**å»ºè®®**ï¼š
```html
<!-- æ·»åŠ èµ„æºç‰ˆæœ¬å· -->
<link rel="stylesheet" href="style/style.css?v=5.0.5">

<!-- æ·»åŠ defer/async -->
<script src="script/common.js?v=5.0.5" defer></script>

<!-- å›¾ç‰‡ä½¿ç”¨WebPæ ¼å¼ -->
<picture>
  <source srcset="image.webp" type="image/webp">
  <img src="image.jpg" alt="">
</picture>
```

---

## ğŸŸ¡ é‡è¦é—®é¢˜ï¼ˆå»ºè®®ä¿®å¤ï¼‰

### 1. ä»£ç è´¨é‡

#### 1.1 ç¼ºå°‘é”™è¯¯å¤„ç†

**é—®é¢˜ç¤ºä¾‹**ï¼š
```php
// è¡Œ323ï¼šæ— é”™è¯¯å¤„ç†
$article->Content = $zbaudio_player . "\r\n" . $zbaudio_config . "\r\n" . $article->Content;
```

**å»ºè®®**ï¼š
```php
try {
    if (isset($article->Metas->audio) && !empty($article->Metas->audio)) {
        $zbaudio_player = $this->generateAudioPlayer($article);
        $zbaudio_config = $this->generateAudioConfig($article);
        $article->Content = $zbaudio_player . "\r\n" . $zbaudio_config . "\r\n" . $article->Content;
    }
} catch (Exception $e) {
    error_log('Audio generation failed: ' . $e->getMessage());
    // ä¼˜é›…é™çº§ï¼Œä¸æ˜¾ç¤ºæ’­æ”¾å™¨
}
```

#### 1.2 é­”æœ¯æ•°å­—å’Œç¡¬ç¼–ç 

**é—®é¢˜**ï¼š
```php
// è¡Œ122: ç¡¬ç¼–ç çš„æ•°å­—
if (count($articles) > 5)
// è¡Œ289: é­”æœ¯æ•°å­—
$time = time() - $time * 24 * 60 * 60;
```

**å»ºè®®**ï¼š
```php
// å®šä¹‰å¸¸é‡
define('TPURE_SEARCH_MAX_RESULTS', 5);
define('TPURE_SECONDS_PER_DAY', 86400);

// ä½¿ç”¨å¸¸é‡
if (count($articles) > TPURE_SEARCH_MAX_RESULTS)
$time = time() - $time * TPURE_SECONDS_PER_DAY;
```

#### 1.3 å‡½æ•°å‘½åä¸è§„èŒƒ

**é—®é¢˜**ï¼š
- éƒ¨åˆ†å‡½æ•°ä½¿ç”¨ä¸‹åˆ’çº¿å‘½å
- éƒ¨åˆ†ä½¿ç”¨é©¼å³°å‘½å
- å‘½åä¸å¤Ÿè¯­ä¹‰åŒ–

**å»ºè®®**ï¼šç»Ÿä¸€ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼Œå¹¶ä½¿ç”¨å‘½åç©ºé—´

```php
namespace Tpure\Helpers;

class StringHelper {
    public static function truncate($string, $length, $suffix = '...') {
        // åŸ SubStrUTF8 å‡½æ•°
    }
}

class TimeHelper {
    public static function timeAgo($timestamp) {
        // åŸ tpure_TimeAgo å‡½æ•°
    }
}
```

---

### 2. å¯ç»´æŠ¤æ€§

#### 2.1 ç¼ºå°‘ä»£ç æ³¨é‡Š

**é—®é¢˜**ï¼šå¤§éƒ¨åˆ†å‡½æ•°æ²¡æœ‰æ–‡æ¡£æ³¨é‡Š

**å»ºè®®**ï¼šä½¿ç”¨PHPDocæ ¼å¼
```php
/**
 * ç”Ÿæˆæ–‡ç« ç¼©ç•¥å›¾URL
 * 
 * @param Post $source æ–‡ç« å¯¹è±¡
 * @param string $isThumb æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨é»˜è®¤ç¼©ç•¥å›¾ '0'=å¦ '1'=æ˜¯
 * @return string ç¼©ç•¥å›¾URL
 * @throws Exception å½“æ–‡ç« å¯¹è±¡æ— æ•ˆæ—¶æŠ›å‡ºå¼‚å¸¸
 */
function tpure_Thumb($source, $isThumb = '0') {
    // å‡½æ•°å®ç°
}
```

#### 2.2 ç¼ºå°‘æµ‹è¯•

**å»ºè®®**ï¼šæ·»åŠ å•å…ƒæµ‹è¯•

```php
// tests/TpureTest.php
<?php
use PHPUnit\Framework\TestCase;

class TpureThumbTest extends TestCase {
    public function testThumbWithCustomImage() {
        $article = $this->createMockArticle();
        $article->Metas->proimg = 'custom.jpg';
        
        $result = tpure_Thumb($article);
        
        $this->assertEquals('custom.jpg', $result);
    }
    
    public function testThumbWithDefaultImage() {
        $article = $this->createMockArticle();
        
        $result = tpure_Thumb($article, '1');
        
        $this->assertNotEmpty($result);
    }
}
```

---

### 3. å…¼å®¹æ€§é—®é¢˜

#### 3.1 PHPç‰ˆæœ¬å…¼å®¹æ€§

**å½“å‰**ï¼šæ”¯æŒPHP 5.2+

**é—®é¢˜**ï¼š
- PHP 5.2å·²ç»åœæ­¢ç»´æŠ¤10å¤šå¹´
- æ— æ³•ä½¿ç”¨ç°ä»£PHPç‰¹æ€§
- å­˜åœ¨å®‰å…¨é£é™©

**å»ºè®®**ï¼š
```xml
<!-- theme.xml -->
<phpver>7.4</phpver>
```

åŒæ—¶ä½¿ç”¨ç°ä»£PHPç‰¹æ€§ï¼š
```php
// ä½¿ç”¨ç±»å‹å£°æ˜
function tpure_Thumb(Post $source, string $isThumb = '0'): string {
    // ...
}

// ä½¿ç”¨å‘½åç©ºé—´å’Œè‡ªåŠ¨åŠ è½½
namespace Tpure;

// ä½¿ç”¨traitå¤ç”¨ä»£ç 
trait CacheTrait {
    public function getCacheKey(): string {
        return 'tpure_' . md5($this->id);
    }
}
```

#### 3.2 æµè§ˆå™¨å…¼å®¹æ€§

**é—®é¢˜**ï¼š
- JavaScriptä½¿ç”¨äº†è¾ƒæ–°çš„API
- æœªåšpolyfillå¤„ç†

**å»ºè®®**ï¼š
```javascript
// ä½¿ç”¨Babelè½¬è¯‘
// .babelrc
{
  "presets": [
    ["@babel/preset-env", {
      "targets": "> 0.25%, not dead"
    }]
  ]
}
```

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–

#### 1.1 å¼•å…¥ç°ä»£åŒ–æ„å»ºå·¥å…·

**å»ºè®®é…ç½®**ï¼š

**package.json**ï¼š
```json
{
  "name": "tpure-theme",
  "version": "5.0.5",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "vite": "^5.0.0",
    "@vitejs/plugin-legacy": "^5.0.0",
    "sass": "^1.69.0",
    "autoprefixer": "^10.4.16",
    "cssnano": "^6.0.1"
  }
}
```

**vite.config.js**ï¼š
```javascript
import { defineConfig } from 'vite';
import legacy from '@vitejs/plugin-legacy';

export default defineConfig({
  plugins: [
    legacy({
      targets: ['defaults', 'not IE 11']
    })
  ],
  build: {
    outDir: 'dist',
    rollupOptions: {
      input: {
        main: 'script/src/main.js',
        admin: 'script/src/admin.js'
      }
    }
  }
});
```

#### 1.2 å›¾ç‰‡ä¼˜åŒ–

**å»ºè®®**ï¼š
1. ä½¿ç”¨WebPæ ¼å¼
2. å®ç°å“åº”å¼å›¾ç‰‡
3. æ·»åŠ å›¾ç‰‡å°ºå¯¸å±æ€§é˜²æ­¢CLS

```php
/**
 * ç”Ÿæˆå“åº”å¼å›¾ç‰‡HTML
 */
function tpure_ResponsiveImage($src, $alt = '', $sizes = '100vw') {
    $webp = str_replace(['.jpg', '.png'], '.webp', $src);
    
    return sprintf(
        '<picture>
            <source srcset="%s" type="image/webp">
            <img src="%s" alt="%s" sizes="%s" loading="lazy" decoding="async">
        </picture>',
        esc_url($webp),
        esc_url($src),
        esc_attr($alt),
        esc_attr($sizes)
    );
}
```

#### 1.3 CSSä¼˜åŒ–

**é—®é¢˜**ï¼šstyle.csså’Œstyle.lessåŒæ—¶å­˜åœ¨

**å»ºè®®**ï¼š
1. ç»Ÿä¸€ä½¿ç”¨SCSS/SASS
2. ä½¿ç”¨CSSå˜é‡
3. æ¨¡å—åŒ–CSSæ–‡ä»¶

```scss
// style/variables.scss
:root {
  --color-primary: #0188fb;
  --color-text: #333;
  --font-base: 14px;
  --spacing-unit: 8px;
}

// style/mixins.scss
@mixin respond-to($breakpoint) {
  @if $breakpoint == 'mobile' {
    @media (max-width: 768px) { @content; }
  }
  @if $breakpoint == 'tablet' {
    @media (min-width: 769px) and (max-width: 1024px) { @content; }
  }
}

// ä½¿ç”¨
.header {
  padding: calc(var(--spacing-unit) * 2);
  
  @include respond-to('mobile') {
    padding: var(--spacing-unit);
  }
}
```

---

### 2. SEOä¼˜åŒ–

#### 2.1 ç»“æ„åŒ–æ•°æ®

**å»ºè®®**ï¼šæ·»åŠ JSON-LDç»“æ„åŒ–æ•°æ®

```php
/**
 * ç”Ÿæˆæ–‡ç« ç»“æ„åŒ–æ•°æ®
 */
function tpure_GenerateStructuredData($article) {
    $data = array(
        '@context' => 'https://schema.org',
        '@type' => 'BlogPosting',
        'headline' => $article->Title,
        'description' => strip_tags($article->Intro),
        'image' => tpure_Thumb($article),
        'datePublished' => date('c', $article->PostTime),
        'dateModified' => date('c', $article->UpdateTime),
        'author' => array(
            '@type' => 'Person',
            'name' => $article->Author->StaticName
        )
    );
    
    return '<script type="application/ld+json">' . 
           json_encode($data, JSON_UNESCAPED_UNICODE) . 
           '</script>';
}
```

#### 2.2 æ·»åŠ sitemapç”Ÿæˆ

```php
/**
 * ç”ŸæˆXML sitemap
 */
function tpure_GenerateSitemap() {
    global $zbp;
    
    header('Content-Type: application/xml; charset=utf-8');
    
    $xml = '<?xml version="1.0" encoding="UTF-8"?>';
    $xml .= '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">';
    
    // é¦–é¡µ
    $xml .= '<url>';
    $xml .= '<loc>' . $zbp->host . '</loc>';
    $xml .= '<changefreq>daily</changefreq>';
    $xml .= '<priority>1.0</priority>';
    $xml .= '</url>';
    
    // æ–‡ç« 
    $articles = $zbp->GetArticleList('*', 
        array(array('=', 'log_Status', 0)),
        array('log_PostTime' => 'DESC'),
        array(500)
    );
    
    foreach ($articles as $article) {
        $xml .= '<url>';
        $xml .= '<loc>' . $article->Url . '</loc>';
        $xml .= '<lastmod>' . date('c', $article->UpdateTime) . '</lastmod>';
        $xml .= '<changefreq>weekly</changefreq>';
        $xml .= '<priority>0.8</priority>';
        $xml .= '</url>';
    }
    
    $xml .= '</urlset>';
    
    echo $xml;
}
```

---

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 3.1 æ— éšœç¢è®¿é—®(A11y)

**å»ºè®®**ï¼š
```html
<!-- æ·»åŠ ARIAæ ‡ç­¾ -->
<nav aria-label="ä¸»å¯¼èˆª">
  <ul role="menu">
    <li role="menuitem"><a href="/">é¦–é¡µ</a></li>
  </ul>
</nav>

<!-- é”®ç›˜å¯¼èˆª -->
<button aria-label="å…³é—­å¼¹çª—" tabindex="0">Ã—</button>

<!-- å±å¹•é˜…è¯»å™¨å‹å¥½ -->
<span class="sr-only">è·³è½¬åˆ°å†…å®¹</span>
```

#### 3.2 æ¸è¿›å¼Webåº”ç”¨(PWA)

**manifest.json**ï¼š
```json
{
  "name": "æ‹“æºçº¯å‡€ä¸»é¢˜",
  "short_name": "Tpure",
  "description": "å“åº”å¼åšå®¢ä¸»é¢˜",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#f1f1f1",
  "theme_color": "#0188fb",
  "icons": [
    {
      "src": "style/images/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "style/images/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

---

## ğŸ“š æœ€ä½³å®è·µå»ºè®®

### 1. ç‰ˆæœ¬æ§åˆ¶

#### 1.1 æ·»åŠ .gitignore

```gitignore
# ç³»ç»Ÿæ–‡ä»¶
.DS_Store
Thumbs.db
desktop.ini

# ç¼–è¾‘å™¨
.vscode/
.idea/
*.sublime-*

# ä¾èµ–
node_modules/
vendor/

# æ„å»ºäº§ç‰©
dist/
*.min.js
*.min.css

# ç¼“å­˜
cache/
*.cache
*.tmp

# é…ç½®æ–‡ä»¶ï¼ˆåŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰
config.local.php
.env

# æ—¥å¿—
*.log
logs/

# å¤‡ä»½æ–‡ä»¶
*.bak
*.backup
*~
```

#### 1.2 è¯­ä¹‰åŒ–ç‰ˆæœ¬

å½“å‰ç‰ˆæœ¬å·ï¼š5.0.5

å»ºè®®ï¼š
- ä¸»ç‰ˆæœ¬å·ï¼šé‡å¤§æ›´æ–°ï¼Œä¸å‘åå…¼å®¹
- æ¬¡ç‰ˆæœ¬å·ï¼šæ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- ä¿®è®¢å·ï¼šbugä¿®å¤

```php
// æ·»åŠ ç‰ˆæœ¬å¸¸é‡
define('TPURE_VERSION', '5.0.5');
define('TPURE_VERSION_MAJOR', 5);
define('TPURE_VERSION_MINOR', 0);
define('TPURE_VERSION_PATCH', 5);
```

---

### 2. æ–‡æ¡£å®Œå–„

#### 2.1 æ·»åŠ README.md

```markdown
# æ‹“æºçº¯å‡€ä¸»é¢˜ (Tpure)

> ä¸€æ¬¾é€‚ç”¨äºZ-BlogPHPçš„å“åº”å¼åšå®¢ä¸»é¢˜

## ç‰¹æ€§

- âœ… å“åº”å¼è®¾è®¡ï¼Œå®Œç¾é€‚é…ç§»åŠ¨ç«¯
- âœ… SEOä¼˜åŒ–ï¼Œæ™ºèƒ½ç”ŸæˆTDK
- âœ… å¤šç§åˆ—è¡¨æ ·å¼ï¼šæ™®é€š/è®ºå›/ç›¸å†Œ/è´´çº¸/çƒ­ç‚¹
- âœ… ç¼“å­˜ç³»ç»Ÿï¼Œæå‡æ€§èƒ½
- âœ… å¤œé—´æ¨¡å¼
- âœ… AjaxåŠ è½½
- âœ… å›¾ç‰‡æ‡’åŠ è½½
- âœ… éŸ³è§†é¢‘æ”¯æŒ

## ç³»ç»Ÿè¦æ±‚

- PHP >= 7.4
- Z-BlogPHP >= 1.7.0
- MySQL >= 5.6

## å®‰è£…

1. ä¸‹è½½ä¸»é¢˜å‹ç¼©åŒ…
2. è§£å‹åˆ° `zb_users/theme/` ç›®å½•
3. åå°å¯ç”¨ä¸»é¢˜
4. è¿›å…¥ä¸»é¢˜è®¾ç½®é…ç½®é€‰é¡¹

## é…ç½®

è¯¦è§ï¼š[é…ç½®æ–‡æ¡£](docs/configuration.md)

## å¼€å‘

### ç¯å¢ƒå‡†å¤‡

\`\`\`bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
\`\`\`

### ç›®å½•ç»“æ„

\`\`\`
tpure/
â”œâ”€â”€ include.php          # ä¸»å…¥å£
â”œâ”€â”€ lib/                 # ç±»åº“
â”œâ”€â”€ template/            # æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ style/              # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ script/             # JavaScript
â”œâ”€â”€ plugin/             # ç¬¬ä¸‰æ–¹æ’ä»¶
â””â”€â”€ docs/               # æ–‡æ¡£
\`\`\`

## æ›´æ–°æ—¥å¿—

è¯¦è§ï¼š[CHANGELOG.md](CHANGELOG.md)

## è®¸å¯è¯

[MIT License](LICENSE)

## æ”¯æŒ

- å®˜ç½‘ï¼šhttps://www.toyean.com/
- æ–‡æ¡£ï¼šhttps://www.toyean.com/doc/
- é—®é¢˜åé¦ˆï¼šhttps://github.com/xxx/tpure/issues

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…
```

#### 2.2 æ·»åŠ CHANGELOG.md

```markdown
# æ›´æ–°æ—¥å¿—

æ‰€æœ‰é‡è¦æ›´æ”¹éƒ½ä¼šè®°å½•åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚

æ ¼å¼åŸºäº [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)ï¼Œ
ç‰ˆæœ¬å·éµå¾ª [è¯­ä¹‰åŒ–ç‰ˆæœ¬](https://semver.org/lang/zh-CN/)ã€‚

## [æœªå‘å¸ƒ]

### æ–°å¢
- æ·»åŠ PWAæ”¯æŒ
- æ·»åŠ æš—é»‘æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢

### ä¿®æ”¹
- ä¼˜åŒ–ä»£ç ç»“æ„
- æ”¹è¿›SEOåŠŸèƒ½

### ä¿®å¤
- ä¿®å¤XSSæ¼æ´
- ä¿®å¤SQLæ³¨å…¥é£é™©

## [5.0.5] - 2025-03-25

### ä¿®æ”¹
- æ›´æ–°ç‰ˆæœ¬å·

## [5.0.0] - 2020-01-01

### æ–°å¢
- åˆå§‹å‘å¸ƒ
```

---

### 3. ä»£ç è§„èŒƒ

#### 3.1 PHPä»£ç è§„èŒƒ (PSR-12)

```php
<?php

declare(strict_types=1);

namespace Tpure\Helpers;

/**
 * å­—ç¬¦ä¸²å¤„ç†è¾…åŠ©ç±»
 */
class StringHelper
{
    /**
     * æˆªå–UTF-8å­—ç¬¦ä¸²
     *
     * @param string $string è¦æˆªå–çš„å­—ç¬¦ä¸²
     * @param int $length æˆªå–é•¿åº¦
     * @param string $suffix åç¼€
     * @return string
     */
    public static function truncate(
        string $string, 
        int $length, 
        string $suffix = '...'
    ): string {
        if (mb_strlen($string, 'UTF-8') <= $length) {
            return $string;
        }
        
        return mb_substr($string, 0, $length, 'UTF-8') . $suffix;
    }
}
```

#### 3.2 JavaScriptä»£ç è§„èŒƒ (ESLint)

**.eslintrc.js**ï¼š
```javascript
module.exports = {
  extends: 'eslint:recommended',
  env: {
    browser: true,
    es2021: true,
    jquery: true
  },
  rules: {
    'indent': ['error', 2],
    'quotes': ['error', 'single'],
    'semi': ['error', 'always'],
    'no-console': 'warn'
  }
};
```

---

### 4. æŒç»­é›†æˆ

#### 4.1 GitHub Actions

**.github/workflows/ci.yml**ï¼š
```yaml
name: CI

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '7.4'
        extensions: mbstring, mysql
    
    - name: Install dependencies
      run: composer install
    
    - name: Run tests
      run: vendor/bin/phpunit
    
    - name: Check code style
      run: vendor/bin/phpcs
  
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build
      run: npm run build
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: dist
        path: dist/
```

---

## ğŸ¯ å®æ–½ä¼˜å…ˆçº§

### P0 - ç«‹å³ä¿®å¤ï¼ˆ1å‘¨å†…ï¼‰

1. **ä¿®å¤XSSæ¼æ´** - å½±å“å®‰å…¨
2. **ä¿®å¤SQLæ³¨å…¥é£é™©** - å½±å“å®‰å…¨
3. **æ·»åŠ æ–‡ä»¶ä¸Šä¼ éªŒè¯** - å½±å“å®‰å…¨
4. **ä¿®å¤é‚®ä»¶æ³¨å…¥** - å½±å“å®‰å…¨

### P1 - é«˜ä¼˜å…ˆçº§ï¼ˆ1ä¸ªæœˆå†…ï¼‰

1. **é‡æ„include.php** - æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶
2. **æ·»åŠ é”™è¯¯å¤„ç†** - æé«˜ç¨³å®šæ€§
3. **ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢** - æå‡æ€§èƒ½
4. **å®Œå–„ç¼“å­˜æœºåˆ¶** - æå‡æ€§èƒ½

### P2 - ä¸­ä¼˜å…ˆçº§ï¼ˆ3ä¸ªæœˆå†…ï¼‰

1. **æ·»åŠ å•å…ƒæµ‹è¯•**
2. **ä»£ç è§„èŒƒåŒ–**
3. **æ–‡æ¡£å®Œå–„**
4. **å¼•å…¥æ„å»ºå·¥å…·**

### P3 - ä½ä¼˜å…ˆçº§ï¼ˆ6ä¸ªæœˆå†…ï¼‰

1. **PWAæ”¯æŒ**
2. **æ— éšœç¢ä¼˜åŒ–**
3. **å›½é™…åŒ–æ”¯æŒ**
4. **ä¸»é¢˜å¸‚åœºå‡†å¤‡**

---

## ğŸ“Š é¢„æœŸæ”¶ç›Š

### å®‰å…¨æ€§æå‡

- âœ… æ¶ˆé™¤XSS/SQLæ³¨å…¥ç­‰å®‰å…¨éšæ‚£
- âœ… é€šè¿‡å®‰å…¨å®¡è®¡
- âœ… æé«˜ç”¨æˆ·ä¿¡ä»»åº¦

### æ€§èƒ½æå‡

- âš¡ é¡µé¢åŠ è½½é€Ÿåº¦æå‡ 30-50%
- âš¡ é¦–å±æ¸²æŸ“æ—¶é—´å‡å°‘ 40%
- âš¡ æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°å‡å°‘ 60%

### å¯ç»´æŠ¤æ€§æå‡

- ğŸ“¦ ä»£ç è¡Œæ•°å‡å°‘ 40%
- ğŸ”§ Bugä¿®å¤æ—¶é—´å‡å°‘ 60%
- ğŸ‘¥ æ–°äººä¸Šæ‰‹æ—¶é—´å‡å°‘ 50%

### SEOæå‡

- ğŸ“ˆ æœç´¢å¼•æ“æ”¶å½•ç‡æå‡ 20-30%
- ğŸ“ˆ Core Web Vitals è¯„åˆ†æå‡
- ğŸ“ˆ ç½‘ç«™æ’åæå‡

---

## ğŸ¤ å®æ–½å»ºè®®

### é˜¶æ®µä¸€ï¼šå®‰å…¨ä¿®å¤ï¼ˆ1å‘¨ï¼‰

1. åˆ›å»ºæ–°åˆ†æ”¯ `security-fix`
2. ä¿®å¤æ‰€æœ‰P0çº§åˆ«å®‰å…¨é—®é¢˜
3. ä»£ç å®¡æŸ¥
4. æµ‹è¯•éªŒè¯
5. åˆå¹¶åˆ°ä¸»åˆ†æ”¯

### é˜¶æ®µäºŒï¼šä»£ç é‡æ„ï¼ˆ1ä¸ªæœˆï¼‰

1. åˆ›å»ºæ–°åˆ†æ”¯ `refactor`
2. æ‹†åˆ†include.php
3. æ·»åŠ å‘½åç©ºé—´
4. ç»Ÿä¸€ä»£ç é£æ ¼
5. æ·»åŠ æ–‡æ¡£æ³¨é‡Š
6. é€æ­¥åˆå¹¶

### é˜¶æ®µä¸‰ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ1ä¸ªæœˆï¼‰

1. ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
2. å®Œå–„ç¼“å­˜ç³»ç»Ÿ
3. å¼•å…¥æ„å»ºå·¥å…·
4. ä¼˜åŒ–èµ„æºåŠ è½½
5. æ€§èƒ½æµ‹è¯•

### é˜¶æ®µå››ï¼šåŠŸèƒ½å®Œå–„ï¼ˆ2ä¸ªæœˆï¼‰

1. æ·»åŠ å•å…ƒæµ‹è¯•
2. å®Œå–„æ–‡æ¡£
3. æ–°åŠŸèƒ½å¼€å‘
4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## âœ… éªŒæ”¶æ ‡å‡†

### ä»£ç è´¨é‡

- [ ] é€šè¿‡PHPStan Level 5æ£€æŸ¥
- [ ] é€šè¿‡PHPCSä»£ç è§„èŒƒæ£€æŸ¥
- [ ] ä»£ç è¦†ç›–ç‡è¾¾åˆ°60%ä»¥ä¸Š
- [ ] æ— å®‰å…¨æ¼æ´

### æ€§èƒ½æŒ‡æ ‡

- [ ] PageSpeed Insights è¯„åˆ† > 90
- [ ] Lighthouse æ€§èƒ½è¯„åˆ† > 90
- [ ] First Contentful Paint < 1.5s
- [ ] Time to Interactive < 3.5s

### æ–‡æ¡£å®Œå–„

- [ ] READMEå®Œæ•´
- [ ] APIæ–‡æ¡£å®Œæ•´
- [ ] é…ç½®æ–‡æ¡£å®Œæ•´
- [ ] æ›´æ–°æ—¥å¿—å®Œæ•´

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š

- **é‚®ç®±**ï¼šyour-email@example.com
- **GitHub**ï¼šhttps://github.com/yourusername
- **å®˜ç½‘**ï¼šhttps://www.toyean.com

---

**æœ€åæ›´æ–°**ï¼š2025å¹´10æœˆ12æ—¥  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**å®¡æŸ¥äººå‘˜**ï¼šAI Assistant

